<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Village Family Tree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body { background: #f0f4f8; }
        .family-tree { display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-x: auto; min-height: 100vh; }
        .generation { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 40px; position: relative; }
        .connector { position: absolute; border-top: 2px solid #94a3b8; width: 70%; top: -20px; }
        .member-card { width: 180px; margin: 10px 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s ease; background: white; position: relative; cursor: pointer; }
        .member-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.2); }
        .member-image { height: 120px; background-size: cover; background-position: center; border-top-left-radius: 12px; border-top-right-radius: 12px; }
        .member-details { padding: 12px; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); z-index:100; justify-content:center; align-items:center; }
        .modal-content { background:white; padding:25px; border-radius:12px; width:90%; max-width:500px; max-height:90vh; overflow-y:auto; }
        .btn { padding:8px 16px; border-radius:6px; font-weight:600; cursor:pointer; transition: all 0.2s; }
        .btn-primary { background-color: #3b82f6; color:white; }
        .btn-primary:hover { background-color: #2563eb; }
        .btn-danger { background-color: #ef4444; color:white; }
        .btn-danger:hover { background-color: #dc2626; }
        .parent-connector { width:1px; height:20px; background:#94a3b8; margin:0 45%; position:absolute; top:-20px; }
        .child-connector { position:absolute; bottom:-20px; left:50%; width:1px; height:20px; background:#94a3b8; }
        @media (max-width:768px) { .member-card{width:140px;margin:8px;} }
    </style>
</head>
<body>
<header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-indigo-800">Gen Tree</h1>
        <button id="add-root-btn" class="btn btn-primary"><i class="fas fa-plus mr-2"></i> Add Member</button>
    </div>
</header>

<main class="container mx-auto py-6 px-4">
    <div class="overflow-auto rounded-lg shadow-lg bg-white p-4">
        <div id="family-tree" class="family-tree"></div>
    </div>
</main>

<!-- Modal -->
<div id="member-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800" id="modal-title">Edit Member</h3>
            <button id="close-modal" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
        </div>
        <form id="member-form" class="space-y-4">
            <input type="hidden" id="member-id">
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                <input type="text" id="name" required class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700">Age</label>
                    <input type="number" id="age" min="0" max="120" required class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label for="occupation" class="block text-sm font-medium text-gray-700">Occupation</label>
                    <input type="text" id="occupation" required class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
            </div>
            <div>
                <label for="image" class="block text-sm font-medium text-gray-700">Image URL</label>
                <input type="url" id="image" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div id="parent-selection">
                <label class="block text-sm font-medium text-gray-700">Parents</label>
                <div class="mt-2 space-y-2" id="parents-container"></div>
            </div>
            <div class="flex justify-between pt-4">
                <button type="button" id="delete-member" class="btn btn-danger">Delete</button>
                <div class="space-x-2">
                    <button type="button" id="cancel-form" class="btn bg-gray-300 text-gray-800">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="flex justify-center mt-6">
    <a href="index.html" 
       class="px-6 py-3 mb-9 bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold rounded-full shadow-lg hover:from-purple-500 hover:to-indigo-500 hover:shadow-xl transition-all duration-300">
       <i class="fas fa-home mr-2"></i> Back to Home
    </a>
</div>
<script>
// âœ… Sample Data: one male and one female with two children
const sampleData = {
    "1": {
        id: "1",
        name: "Rajesh Kumar",
        age: 45,
        occupation: "Farmer",
        image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
        parents: [],
        children: ["3", "4"]
    },
    "2": {
        id: "2",
        name: "Sunita Devi",
        age: 42,
        occupation: "Homemaker",
        image: "https://images.unsplash.com/photo-1551847810-9e6c2c6dc16e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
        parents: [],
        children: ["3", "4"]
    },
    "3": {
        id: "3",
        name: "Amit Kumar",
        age: 20,
        occupation: "Student",
        image: "https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
        parents: ["1", "2"],
        children: []
    },
    "4": {
        id: "4",
        name: "Pooja Kumari",
        age: 18,
        occupation: "Student",
        image: "https://images.unsplash.com/photo-1590086782792-42dd2350140d?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80",
        parents: ["1", "2"],
        children: []
    }
};

class FamilyTree {
    constructor() {
        this.members = new Map();
        this.loadFromLocalStorage();
        if(this.members.size === 0){
            Object.values(sampleData).forEach(m => this.members.set(m.id, m));
            this.saveToLocalStorage();
        }
        this.renderTree();
        this.setupEventListeners();
    }

    loadFromLocalStorage() {
        try {
            const data = localStorage.getItem('familyTreeData');
            if(data){
                const parsed = JSON.parse(data);
                this.members = new Map();
                for(const [key, val] of Object.entries(parsed)){
                    this.members.set(key, val);
                }
            }
        } catch(err){
            console.error("Error loading from localStorage:", err);
            this.members = new Map();
        }
    }

    saveToLocalStorage() {
        const data = Object.fromEntries(this.members);
        localStorage.setItem('familyTreeData', JSON.stringify(data));
    }

    renderTree() {
        const treeContainer = document.getElementById('family-tree');
        treeContainer.innerHTML = '';
        const generations = this.getGenerations();
        generations.forEach((gen, index) => {
            const div = document.createElement('div');
            div.className = 'generation';
            div.id = `generation-${index}`;
            if(index > 0){
                const c = document.createElement('div');
                c.className = 'connector';
                div.appendChild(c);
            }
            gen.forEach(id => {
                const member = this.members.get(id);
                if(member){
                    div.appendChild(this.createMemberCard(member));
                }
            });
            treeContainer.appendChild(div);
        });
    }

    createMemberCard(member) {
        const card = document.createElement('div');
        card.className = 'member-card';
        card.dataset.id = member.id;

        if(member.parents && member.parents.length > 0){
            const pc = document.createElement('div');
            pc.className = 'parent-connector';
            card.appendChild(pc);
        }
        if(member.children && member.children.length > 0){
            const cc = document.createElement('div');
            cc.className = 'child-connector';
            card.appendChild(cc);
        }

        const img = document.createElement('div');
        img.className = 'member-image';
        img.style.backgroundImage = `url(${member.image || 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80'})`;

        const details = document.createElement('div');
        details.className = 'member-details';
        details.innerHTML = `
            <h3 class="font-bold text-lg truncate">${member.name}</h3>
            <p class="text-gray-600">Age: ${member.age}</p>
            <p class="text-gray-600 truncate">${member.occupation}</p>
        `;

        card.appendChild(img);
        card.appendChild(details);

        card.addEventListener('click', () => this.openEditModal(member.id));

        return card;
    }

    getGenerations() {
        const generations = [];
        const added = new Set();
        const roots = Array.from(this.members.values()).filter(m => !m.parents || m.parents.length === 0);
        generations[0] = roots.map(m => m.id);
        roots.forEach(m => added.add(m.id));
        let curr = 0;
        while(generations[curr] && generations[curr].length > 0){
            const next = [];
            for(const id of generations[curr]){
                const member = this.members.get(id);
                if(member && member.children){
                    member.children.forEach(cid => {
                        if(!added.has(cid) && this.members.has(cid)){
                            next.push(cid);
                            added.add(cid);
                        }
                    });
                }
            }
            if(next.length > 0){
                generations[curr + 1] = next;
            }
            curr++;
        }
        return generations;
    }

    openEditModal(memberId = null) {
        const modal = document.getElementById('member-modal');
        const title = document.getElementById('modal-title');
        const deleteBtn = document.getElementById('delete-member');
        const form = document.getElementById('member-form');

        if(memberId){
            const member = this.members.get(memberId);
            title.textContent = 'Edit Family Member';
            document.getElementById('member-id').value = member.id;
            document.getElementById('name').value = member.name;
            document.getElementById('age').value = member.age;
            document.getElementById('occupation').value = member.occupation;
            document.getElementById('image').value = member.image || '';
            deleteBtn.style.display = 'block';
            this.renderParentOptions(member);
        } else {
            const newId = Date.now().toString();
            document.getElementById('member-id').value = newId;
            form.reset();
            deleteBtn.style.display = 'none';
            title.textContent = 'Add Family Member';
            this.renderParentOptions();
        }

        modal.style.display = 'flex';
    }

    renderParentOptions(editMember = null) {
        const container = document.getElementById('parents-container');
        container.innerHTML = '';
        const potentialParents = Array.from(this.members.values()).filter(m => !editMember || m.id !== editMember.id);
        if(potentialParents.length === 0){
            container.innerHTML = '<p class="text-sm text-gray-500">No potential parents available</p>';
            return;
        }
        potentialParents.forEach(p => {
            const div = document.createElement('div');
            div.className = 'flex items-center';
            const cb = document.createElement('input');
            cb.type = 'checkbox';
            cb.value = p.id;
            cb.id = `parent-${p.id}`;
            cb.className = 'mr-2';
            if(editMember && editMember.parents.includes(p.id)){
                cb.checked = true;
            }
            const label = document.createElement('label');
            label.htmlFor = `parent-${p.id}`;
            label.className = 'text-sm text-gray-700';
            label.textContent = p.name;
            div.appendChild(cb);
            div.appendChild(label);
            container.appendChild(div);
        });
    }

    handleFormSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('member-id').value;
        const name = document.getElementById('name').value.trim();
        const age = parseInt(document.getElementById('age').value);
        const occupation = document.getElementById('occupation').value.trim();
        const image = document.getElementById('image').value.trim();
        const parents = [];
        document.querySelectorAll('#parents-container input[type="checkbox"]').forEach(cb => {
            if(cb.checked){
                parents.push(cb.value);
            }
        });

        const oldMember = this.members.get(id);
        const member = {
            id,
            name,
            age,
            occupation,
            image: image || undefined,
            parents,
            children: oldMember ? oldMember.children : []
        };

        // Update parents
        parents.forEach(pid => {
            const parent = this.members.get(pid);
            if(parent && !parent.children.includes(id)){
                parent.children.push(id);
            }
        });

        // Remove from old parents if any
        if(oldMember){
            oldMember.parents.forEach(opid => {
                if(!parents.includes(opid)){
                    const op = this.members.get(opid);
                    if(op){
                        op.children = op.children.filter(c => c !== id);
                    }
                }
            });
        }

        this.members.set(id, member);
        this.saveToLocalStorage();
        this.renderTree();
        document.getElementById('member-modal').style.display = 'none';
    }

    deleteMember() {
        const id = document.getElementById('member-id').value;
        if(!id) return;
        if(confirm('Are you sure you want to delete this member?')){
            const member = this.members.get(id);
            if(member.parents){
                member.parents.forEach(pid => {
                    const p = this.members.get(pid);
                    if(p){
                        p.children = p.children.filter(c => c !== id);
                    }
                });
            }
            this.members.delete(id);
            this.saveToLocalStorage();
            this.renderTree();
            document.getElementById('member-modal').style.display = 'none';
        }
    }

    setupEventListeners() {
        document.getElementById('add-root-btn').addEventListener('click', () => this.openEditModal());
        document.getElementById('close-modal').addEventListener('click', () => document.getElementById('member-modal').style.display = 'none');
        document.getElementById('cancel-form').addEventListener('click', () => document.getElementById('member-modal').style.display = 'none');
        document.getElementById('member-form').addEventListener('submit', e => this.handleFormSubmit(e));
        document.getElementById('delete-member').addEventListener('click', () => this.deleteMember());
        window.addEventListener('click', e => {
            if(e.target === document.getElementById('member-modal')){
                document.getElementById('member-modal').style.display = 'none';
            }
        });
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new FamilyTree();
});
</script>
</body>
</html>
